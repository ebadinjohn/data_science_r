---
title: "JEE_classification"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, error = FALSE, warning = FALSE)
```

**Importing the dataset 'frs_housing_data' **

To perform this task the prepared dataset was imported into R studio using the tidyverse
package. Special care was taken to ensure that all 36 variables were imported with the right 
data type integer for numeric variables and factor for categorical variables. Thereafter, 
PTENTYP2 which is the variable from which RENTYP (rent type) was created and serial number (SERNUM)
were dropped because they were irrelevant for the classification task.

```{r}
library(tidyverse)
datatype <- c('iiiiiiiiiiiiiiiiiiffffffffffffffffff')
frs_housing_data <- read_csv('D:/ASDM_Coursework/Datasets/frs_housing_data.csv', col_types = datatype)

frs_housing_data <- frs_housing_data %>% select(!c(PTENTYP2, SERNUM))
```
Note: Full codes used for classification task are contained in appendix 2. Only excerpts of 
codes are displayed here.

**Task1: Classification (Decision Tree Algorithm in R and SAS)**
**(Ia.) Classification of UK tenants according to type of rented accommodation inhabited in R**

Boruta package was used for feature selection. Multiple household (MULTI)
and household status (HHSTAT) were found to be unimportant variables for the 
classification of rent type (RENTYP) and were thus excluded from the model.

```{r}
library(Boruta)
feat_select_RENTYP <- Boruta(RENTYP~., data = frs_housing_data, maxRuns = 500, doTrace = 2)

feat_select_RENTYP_TRF <- TentativeRoughFix(feat_select_RENTYP)

plot(feat_select_RENTYP_TRF, horizontal = TRUE, las= 1, cex=0.5)

```

31 variables were found to be important for the classification of RENTYP and they are given by
the formula:

```{r}
formula_RENTYP <- getConfirmedFormula(feat_select_RENTYP_TRF)

formula_RENTYP

```
**Class Imbalance**
In the graph (----) below, social rented housing has 3544 observations while private rented housing has 
3252 observation. The classes are not exactly the same but they are not also significantly imbalanced. 
Therefore, the was no need to correct class imbalance in the dependent variable.

**Splitting and Sampling Proportion**
Splitting of data into training and test set was done using stratified random sampling (code----).
Stratified random sampling was employed to ensure that equal amounts of both classes 
(social and private rented classes) were sampled into the training and test sets respectively.
A sampling proportion of 80% for training set (task1_RENTYP_train) and 20% for 
test set (task1_RENTYP_test) was used. The training set was used to develop the model while the 
test set was used to validate the accuracy of the model built with the training set.
The proportion of data used in the training set had to be greater so that the model 
could be sufficiently trained for better accuracy.

```{r, echo=FALSE, include=FALSE}
# Visualizing the dependent variable.
my_theme <- function() {theme(
  plot.subtitle = element_text(hjust=0, 
                               face='italic'),
  axis.title = element_text(face='bold', 
                            color = ('lemonchiffon4')),
  plot.margin = margin(0.5,0.5,0.5,0.5, 'cm'),
  panel.background = element_rect(fill= 'white'),
  panel.border = element_rect(color = 'grey', fill = NA),
  panel.grid.major = element_line(color = 'grey', linetype = 2, size = 0.5),
  panel.grid.minor = element_line(color = 'grey', linetype= 3, size = 0.5)
)}

```

```{r, echo=FALSE}

frs_hh_clean %>% ggplot(aes(RENTYP))+
  geom_bar(alpha= 1, width = 0.5, fill = (c=12))+
  geom_text(aes(label = ..count..), stat = 'count', vjust = 1.5)+
  labs(title = 'RENTYP - Rent Type', 
       subtitle = '1=social rented housing, 2=private rented housing',
       x= 'Rent Type',
       y= 'Count',
       caption = 'Family Resources Survey 2019-20' )+my_theme()
```

```{r}
install.packages('rsample')
library(rsample)
```

```{r}
task1_RENTYP_split <- initial_split(frs_housing_data, prop = 0.8, strata = RENTYP)
task1_RENTYP_train <- training(task1_RENTYP_split)
task1_RENTYP_train
task1_RENTYP_test <- testing(task1_RENTYP_split)
task1_RENTYP_test
```

head(task1_RENTYP_train)
dim(task1_RENTYP_train)
head(task1_RENTYP_test)
dim(task1_RENTYP_test)

library(party)
RENTYP_dt <- ctree(formula_RENTYP, data = task1_RENTYP_train)
print(RENTYP_dt)
plot(RENTYP_dt, type = 'simple')

RENTYP_prediction <- predict(RENTYP_dt, newdata = task1_RENTYP_test)

RENTYP_prediction_acc <- diag(RENTYP_prediction)/sum(RENTYP_prediction)
RENTYP_prediction_error <- 1 - RENTYP_prediction_acc

install.packages('randomforest')
library(randomforest)


